name: C/C++ CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:    
    - name: "checkout repo"
      uses: actions/checkout@v3

    - name: "checkout catch2"
      uses: actions/checkout@v4
      with:
        repository: "catchorg/Catch2"
        path: catch2
    
    - name: "change into cloned catch2 repo"
      run: cd catch2
    - name: "create build files for catch2"
      run: cmake -B build -H. -DBUILD_TESTING=OFF
    - name: "install catch2"
      run: sudo cmake --build build/ --target install
    - name: "exit catch2 dir"
      run: cd ..
  
    - name: "cmake generate build files"
      run: cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
    - name: "build all"
      run: cmake --build build --target all --config Release 
      
    - name: "change to build dir"
      run: cd build
    - name: "run tests"
      run: make test
